## 网络是怎样连接的

户根勤  -  计算机榜-计算机综合

> 本书以探索之旅的形式，从在浏览器中输入网址开始，一路追踪了到显示出网页内容为止的整个过程，以图配文，讲解了网络的全貌，并重点介绍了实际的网络设备和软件是如何工作的。目的是帮助读者理解网络的本质意义，理解实际的设备和软件，进而熟练运用网络技术。同时，专设了“网络术语其实很简单”专栏，以对话的形式介绍了一些网络术语的词源，颇为生动有趣。本书图文并茂，通俗易懂，非常适合计算机、网络爱好者及相关从业人员阅读。

### 作者/译者简介

译有《图解CIO工作指南（第4版）》《大数据的冲击》《代码的未来》《30天自制操作系统》《图解密码技术》《家用游戏机简史》《有趣的二进制》等。 c:61

### 推荐序

从浏览器输入网址开始，引入了HTTP消息；由于消息要交给服务器，所以用DNS来解析其域名；消息到达服务器之前需要传输，就要懂得TCP和路由交换…… c:49

### 译者序

不理解网络的全貌，也就无法理解每一种网络技术背后的本质意义。 c:474

《Wireshark网络分析就这么简单》和《Wireshark网络分析的艺术》 c:612

### 前言

首先，本书讲解了网络的全貌 c:14

### 本书的结构

（1）浏览器：“请给我×××网页的数据。”
（2） Web服务器：“好的，这就是你要的数据。” c:320

### 探索之旅路线图

（1）浏览器向Web服务器发送请求。（2） Web服务器根据请求向浏览器发送响应。 c:232

包相当于信件或者包裹，而交换机和路由器则相当于邮局或快递公司的分拣处理区。包的头部存有目的地等控制信息，通过许多交换机和路由器的接力，就可以根据控制信息对这些包进行分拣，然后将它们一步一步地搬运到目的地。 c:767

浏览器并不会亲自负责数据的传送。传送消息是搬运数字信息的机制负责的工作，因此浏览器会委托它将数据发送出去。具体来说，就是委托操作系统中的网络控制软件将消息发送给服务器。 c:422

协议栈（网络控制软件叫作协议栈） c:563

网页数据中有一部分是可以重复利用的，这些可以重复利用的数据就被保存在缓存服务器中。如果要访问的网页数据正好在缓存服务器中能够找到，那么就可以不用劳烦Web服务器，直接从缓存服务器读出数据。 c:439

### 网络是怎样连接的——本书中涉及的主要关键词

网址到显示出网页内容这一过程中的具体原理。 c:32

### 第1章 浏览器生成消息——探索浏览器内部

www只是Web服务器上的一种命名。而且，World Wide Web也不是一个协议的名字，而是Web的提出者最早开发的浏览器兼HTML编辑器的名字。 c:195

应用程序并不是自己去控制网络，而是委托操作系统来控制网络。 c:314

### 1.1 生成HTTP请求消息

浏览器是一个具备多种客户端功能的综合性客户端软件，因此它需要一些东西来判断应该使用其中哪种功能来访问相应的数据，而各种不同的URL就是用来干这个的，比如访问Web服务器时用“http:”，而访问FTP服务器时用“ftp:”。 c:738

浏览器会使用HTTP协议来访问Web服务器 c:29

写完消息头之后，还需要添加一个完全没有内容的空行，然后写上需要发送的数据。这一部分称为消息体，也就是消息的主体。 c:88

在响应消息中，第一行的内容为状态码和响应短语，用来表示请求的执行结果是成功还是出错。 c:85

由于每条请求消息中只能写1个URI，所以每次只能获取1个文件，如果需要获取多个文件，必须对每个文件单独发送1条请求。比如1个网页中包含3张图片，那么获取网页加上获取图片，一共需要向Web服务器发送4条请求。 c:440

1条请求消息中只能写1个URI。如果需要获取多个文件，必须对每个文件单独发送1条请求。 c:313

### 1.2 向DNS服务器查询Web服务器的IP地址

对于DNS服务器，我们的计算机上一定有相应的DNS客户端，而相当于DNS客户端的部分称为DNS解析器，或者简称解析器。通过DNS查询IP地址的操作称为域名解析，因此负责执行解析（resolution）这一操作的就叫解析器（resolver）了。 c:797

### 1.4 委托协议栈发送消息

就是我们要访问的Web服务器发送消息了。要发送给Web服务器的HTTP消息 c:95

向操作系统内部的协议栈发出委托时，需要按照指定的顺序来调用Socket库中的程序组件。 c:392

同一台计算机上可能同时存在多个套接字，在这样的情况下，我们就需要一种方法来识别出某个特定的套接字，这种方法就是描述符 c:451

如果说描述符是用来在一台计算机内部识别套接字的机制，那么端口号就是用来让通信的另一方能够识别出套接字的机制[插图]。 c:509

对于同一台服务器来说，重复连接和断开显然是效率很低的，因此后来人们又设计出了能够在一次连接中收发多个请求和响应的方法。在HTTP版本1.1中就可以使用这种方法，在这种情况下，当所有数据都请求完成后，浏览器会主动触发断开连接的操作。 c:279

### CoIumn网络术语其实很简单

词汇是人类创造的，如果能理解词汇创造者的思路，也就能理解这个词的真正含义。 c:59

ARP是根据已知IP地址求出MAC地址这个答案 c:257

### 第2章 用电信号传输TCP/IP——探索协议栈和网卡

在网络包出现之前，通信都是像电话一样把线路连接起来进行的。但是，连接线路的通信方式只能和固定的对象进行通信，无法发挥计算机可以处理多种工作的特点。为了解决这个问题，人们设计出了使用网络包来进行通信的方式。 c:25

### 2.1 创建套接字

操作系统中的网络控制软件（协议栈）和网络硬件（网卡） c:155

将网络包发送给通信对象的操作就是由IP来负责的。此外，IP中还包括ICMP￼协议和ARP￼协议。ICMP用于告知网络包传送过程中产生的错误以及各种控制消息，ARP用于根据IP地址查询相应的以太网MAC地址￼。 c:278

ICMP用于告知网络包传送过程中产生的错误以及各种控制消息，ARP用于根据IP地址查询相应的以太网MAC地址￼。 c:604

### 2.2 连接服务器

连接实际上是通信双方交换控制信息，在套接字中记录这些必要信息并准备数据收发的一连串操作 c:293

通信操作中使用的控制信息分为两类。（1）头部中记录的信息（2）套接字（协议栈中的内存空间）中记录的信息 c:449

### 2.3 收发数据

MTU：一个网络包的最大长度，以太网中一般为1500字节。MSS：除去头部之后，一个网络包所能容纳的TCP数据的最大长度。 c:432

图2.7 序号和ACK号的用法 c:51

通过“序号”和“ACK号”可以确认接收方是否收到了网络包。 c:283

首先，接收方需要告诉发送方自己最多能接收多少数据，然后发送方根据这个值对数据发送操作进行控制，这就是滑动窗口方式的基本思路。 c:438

实际上，接收方在收到数据之后马上就会开始进行处理，如果接收方的性能高，处理速度比包的到达速率还快，缓冲区马上就会被清空，并通过窗口字段告知发送方。 c:23

前面提到的能够接收的最大数据量称为窗口大小[插图]，它是TCP调优参数中非常有名的一个。 c:291

因此当接收方将数据传递给应用程序，导致接收缓冲区剩余容量增加时，就需要告知发送方，这就是更新窗口大小的时机。 c:219

首先，协议栈会检查收到的数据块和TCP头部的内容，判断是否有数据丢失，如果没有问题则返回ACK号。然后，协议栈将数据块暂存到接收缓冲区中，并将数据块按顺序连接起来还原出原始的数据，最后将数据交给应用程序。具体来说，协议栈会将接收到的数据复制到应用程序指定的内存地址中，然后将控制流程交回应用程序。将数据交给应用程序之后，协议栈还需要找到合适的时机向发送方发送窗口更新[插图]。 c:272

### 2.5 IP与以太网的包收发操作

TCP模块在执行连接、收发、断开等各阶段操作时，都需要委托IP模块将数据封装成包发送给通信对象。 c:222

网络中有路由器和集线器两种不同的转发设备，它们在传输网络包时有着各自的分工。（1）路由器根据目标地址判断下一个路由器的位置（2）集线器在子网中将网络包传输到下一个路由实际上，集线器是按照以太网规则传输包的设备，而路由器是按照IP规则传输包的设备， c:332

传递给网卡的网络包是由一连串0和1组成的数字信息，网卡会将这些数字信息转换为电信号或光信号，并通过网线（或光纤）发送出去，然后这些信号就会到达集线器、路由器等转发设备，再由转发设备一步一步地送达接收方。 c:271

表2.2 IP头部格式 c:63

IP地址实际上并不是分配给计算机的，而是分配给网卡的，因此当计算机上存在多块网卡时，每一块网卡都会有自己的IP地址。 c:342

IP模块在生成IP头部之后，会在它前面再加上MAC头部。MAC头部是以太网使用的头部，它包含了接收方和发送方的MAC地址等信息。 c:152

MAC地址是在网卡生产时写入ROM里的，只要将这个值读取出来写入MAC头部就可以了￼。 c:65

MAC地址是在网卡生产时写入ROM里的，只要将这个值读取出来写入MAC头部就可以了[插图]。 c:156

IP模块根据路由表Gateway栏的内容判断应该把包发送给谁。 c:203

查询MAC地址需要使用ARP。 c:145

以太网是一种为多台计算机能够彼此自由和廉价地相互通信而设计的通信技术 c:208

尽管以太网经历了数次变迁，但其基本的3个性质至今仍未改变，即将包发送到MAC头部的接收方MAC地址代表的目的地，用发送方MAC地址识别发送方，用以太类型识别包的内容。因此，大家可以认为具备这3个性质的网络就是以太网[插图]。 c:234

IP生成的网络包只是存放在内存中的一串数字信息，没有办法直接发送给对方。因此，我们需要将数字信息转换为电或光信号，才能在网线上传输，也就是说，这才是真正的数据发送过程。 c:132

网卡的ROM中保存着全世界唯一的MAC地址，这是在生产网卡时写入的。
网卡中保存的MAC地址会由网卡驱动程序读取并分配给MAC模块。 c:150

网卡的ROM中保存着全世界唯一的MAC地址，这是在生产网卡时写入的。网卡中保存的MAC地址会由网卡驱动程序读取并分配给MAC模块。 c:68

MAC模块会将包从缓冲区中取出，并在开头加上报头和起始帧分界符，在末尾加上用于检测错误的帧校验序列 c:76

因此，我们不能一开始就发送包的数据，而是要在前面加上一段用来测量时钟信号的特殊信号，这就是报头的作用[插图]。 c:210

发送信号的操作分为两种，一种是使用集线器的半双工模式，另一种是使用交换机的全双工￼模式。 c:267

网卡的MAC模块生成通用信号，然后由PHY（MAU）模块转换成可在网线中传输的格式，并通过网线发送出去。 c:241

通知计算机的操作会使用一个叫作中断的机制。在网卡执行接收包的操作的过程中，计算机并不是一直监控着网卡的活动，而是去继续执行其他的任务。因此，如果网卡不通知计算机，计算机是不知道包已经收到了这件事的。网卡驱动也是在计算机中运行的一个程序，因此它也不知道包到达的状态。在这种情况下，我们需要一种机制能够打断计算机正在执行的任务，让计算机注意到网卡中发生的事情，这种机制就是中断。 c:99

网卡不会关心包里的内容，只要按照以太类型将包交给对应的协议栈就可以了。接下来，协议栈会判断这个包应该交给哪个应用程序，并进行相应的处理。 c:67

### 2.6 UDP协议的收发操作

不需要重发的数据用UDP发送更高效 c:66

向DNS服务器查询IP地址的时候我们用的也是UDP协议 c:184

我们需要将数据高效且可靠地发送给对方。为了实现可靠性，我们就需要确认对方是否收到了我们发送的数据，如果没有还需要再发一遍。 c:112

像DNS查询等交换控制信息的操作基本上都可以在一个包的大小范围内解决，这种场景中就可以用UDP来代替TCP￼。 c:158

在这些无需重发数据，或者是重发了也没什么意义的情况下，使用UDP发送数据的效率会更高。 c:169

### CoIumn网络术语其实很简单

我们现在用的计算机的原型也是施乐设计的。 c:23

### 第3章 从网络到网络设备——探索集线器、交换机和路由器

路由器和交换机一样也负责对包进行转发，但它们的工作方式有一些差异。交换机是基于以太网规格工作的设备，而路由器是基于IP工作的 c:321

### 3.1 信号在网线和集线器中传输

产生噪声的原因是网线周围的电磁波，当电磁波接触到金属等导体时，在其中就会产生电流。 c:234

集线器将信号发送给所有连接在它上面的线路。 c:133

### 3.2 交换机的包转发操作

交换机根据地址表进行转发 c:39

### 3.3 路由器的包转发操作

因为路由器是基于IP设计的，而交换机是基于以太网设计的[插图]。 c:239

如果在路由表中无法找到匹配的记录，路由器会丢弃这个包，并通过ICMP[插图]消息告知发送方[插图]。这里的处理方式和交换机不同，原因在于网络规模的大小。 c:191

路由表中子网掩码为0.0.0.0的记录表示“默认路由”。 c:174

第一个工作是更新IP头部中的TTL（Time to Live，生存时间）字段（参见第2章的表2.2）。TTL字段表示包的有效期，包每经过一个路由器的转发，这个值就会减1，当这个值变成0时，就表示超过了有效期，这个包就会被丢弃。 c:189

TCP拆分数据的操作是在将数据装到包里之前进行的，换句话说，拆分好的一个数据块正好装进一个包里。从IP分片的角度来看，这样一个包其实是一个未拆分的整体，也就是说，分片是对一个完整的包再进行拆分的过程。 c:116

如果查询标志字段发现不能分片，那么就只能丢弃这个包，并通过ICMP消息通知发送方。 c:92

路由器判断下一个转发目标的方法如下。●如果路由表的网关列内容为IP地址，则该地址就是下一个转发目标。●如果路由表的网关列内容为空，则IP头部中的接收方IP地址就是下一个转发目标。路由器也会使用ARP来查询下一个转发目标的MAC地址。 c:71

路由器判断下一个转发目标的方法如下。
●如果路由表的网关列内容为IP地址，则该地址就是下一个转发目标。
●如果路由表的网关列内容为空，则IP头部中的接收方IP地址就是下一个转发目标。 c:182

如果输出端口为以太网，则发送出去的网络包会通过交换机到达下一个路由器。 c:42

IP（路由器）负责将包送达通信对象这一整体过程，而其中将包传输到下一个路由器的过程则是由以太网（交换机）来负责的。 c:203

### 3.4 路由器的附加功能

规定某些地址是用于内网的，这些地址叫作私有地址，而原来的固定地址则叫作公有地址[插图]。 c:143

相对地，内网部分则分配私有地址，内网中的设备不能和互联网直接收发网络包，而是通过一种特别的机制进行连接，这个机制就叫地址转换。 c:196

地址转换的基本原理是在转发网络包时对IP头部中的IP地址和端口号[插图]进行改写。 c:237

在对外只能使用一个公有地址的情况下，可以用不同的端口号来区别内网中的不同终端。 c:133

改写端口号正是为了解决这个问题。客户端一方的端口号本来就是从空闲端口中随机选择的，因此改写了也不会有问题。端口号是一个16比特的数值，总共可以分配出几万个端口[插图]，因此如果用公有地址加上端口的组合对应一个私有地址，一个公有地址就可以对应几万个私有地址，这种方法提高了公有地址的利用率。 c:106

换个角度来看，这意味着对于没有在访问互联网的内网设备，是无法从互联网向其发送网络包的。而且即便是正在访问的设备，也只能向和互联网通信中使用的那个端口发送网络包，无法向其他端口发送包。也就是说，除非公司主动允许，否则是无法从互联网向公司内网发送网络包的。这种机制具有防止非法入侵的效果。 c:88

只要事先将地址和端口的关联信息添加到地址转换设备的对应表中，就可以从互联网访问内网中的设备了。 c:87

包过滤就是在对包进行转发时，根据MAC头部、IP头部、TCP头部的内容[插图]，按照事先设置好的规则决定是转发这个包，还是丢弃这个包。我们通常说的防火墙设备或软件，大多数都是利用这一机制来防止非法入侵的[插图]。 c:239

### CoIumn网络术语其实很简单

集线器（repeater hub）和交换机（switching hub） c:17

小型廉价的普及型产品一般叫交换机，大型的高性能产品一般叫二层交换机。 c:41

### 第4章 通过接入网进入互联网内部——探索接入网和网络运营商

电信号和光信号传播的速度大体上相同，之所以电缆不如光纤通信速率高，是因为电信号在提升通信速率的同时，其衰减率也会提高（信号在传播过程中减弱），导致信号无法传到目的地。相对地，光信号本来的衰减率就很低，提高通信速率也并不会提高衰减率。此外，光纤还不受电磁噪声的影响，因此光纤能够进行高速通信。 c:60

互联网是由多个运营商网络相互连接形成的巨大网络，而多个运营商之间相互连接的部分可以说就是互联网的核心部分 c:29

### 4.1 ADSL接入网的结构和工作方式

距离的不同和路由的维护方式，就是互联网与家庭、公司网络之间最主要的两个不同点。 c:275

所谓接入网，就是指连接互联网与家庭、公司网络的通信线路￼。一般家用的接入网方式包括ADSL￼、FTTH￼、CATV、电话线、ISDN等，公司则还可能使用专线。 c:117

用户端路由器[插图]发出的网络包通过ADSL Modem[插图]和电话线到达电话局，然后到达ADSL的网络运营商（即ISP，互联网服务提供商）。 c:23

互联网接入路由器会在网络包前面加上MAC头部、PPPoE头部、PPP头部总共3种头部，然后发送给ADSL Modem （PPPoE方式下）。 c:162

ADSL Modem将包拆分成信元，并转换成电信号发送给分离器。 c:74

ADSL Modem采用了一种用圆滑波形（正弦波）对信号进行合成来表示0和1的技术，这种技术称为调制。调制有很多方式，ADSL采用的调制方式是振幅调制（ASK）和相位调制（PSK）相结合的正交振幅调制（QAM）[插图]方式。 c:107

ADSL使用间隔为4.3125 kHz的上百个不同频率的波进行合成，每个波都采用正交振幅调制，而且，根据噪声等条件的不同，每个波表示的比特数是可变的 c:64

噪声和衰减等影响线路质量的因素在每条线路上都不同，而且会随着时间发生变化。因此，ADSL会持续检查线路质量，动态判断使用的频段数量，以及每个频段分配到的比特数。具体来说，当Modem通电后，会发送测试信号，并根据信号的接收情况判断使用的频段数量和每个频段的比特数，这个过程称为训练（握手），需要几秒到几十秒的时间。 c:84

分离器的作用其实在相反的方向，也就是信号从电话线传入的时候。这时，分离器需要负责将电话和ADSL的信号进行分离 c:90

保安器是为了防止雷电等情况下电话线中产生过大电流的一种保护装置，内部有保险丝。 c:23

ADSL信号分布在多个频段上，只有和噪声频率相同的信号会受到影响而无法读取，即可用的信号数量减少，结果导致速率下降。 c:60

DSLAM具有ATM接口，和后方路由器收发数据时使用的是原始网络包拆分后的ATM信元形式。 c:83

BAS负责将ATM信元还原成网络包并转发到互联网内部。 c:94

### 4.2 光纤接入网（FTTH）

ADSL信号是由多个频段的信号组成的，比较复杂，但光信号却非常简单，亮表示1，暗表示0。 c:120

### 4.3 接入网中使用的PPP和隧道

[插图]图4.17 PPP拨号连接操作 c:12

PPPoE是将PPP消息装入以太网包进行传输的方式。 c:134

互联网接入路由器通过PPPoE的发现机制查询BAS的MAC地址。 c:146

只不过在通过路由表判断转发目标之后，包不是按照以太网规则转发，而是按照PPPoE规则转发 c:36

BAS在收到用户路由器发送的网络包之后，会去掉MAC头部和PPPoE头部，然后用隧道机制将包发送给网络运营商的路由器。 c:93

一对一连接的端口可以不分配IP地址，这种方式称为无编号。 c:93

PPPoA方式不添加MAC头部和PPPoE头部，而是直接将包装入信元中。 c:74

有一些运营商不使用PPP，他们使用DHCP[插图]协议从BAS向用户端下发TCP/IP配置信息。 c:56

还有一种DHCP方式，它不使用PPP，而是将以太网包直接转换成ADSL信号发送给DSLAM。 c:72

### 4.4 网络运营商的内部

ADSL、FTTH等接入网是与用户签约的运营商设备相连的，这些设备称为POP[插图]，互联网的入口就位于这里。 c:100

NOC[插图]是运营商的核心设备，从POP传来的网络包都会集中到这里，并从这里被转发到离目的地更近的POP，或者是转发到其他的运营商。这里也需要配备高性能的路由器。 c:120

### 4.5 跨越运营商的网络包

图4.25 运营商之间的路由信息交换 c:17

这个路由信息交换的过程是由路由器自动完成的，这里使用的机制称为BGP[插图]。 c:127

只有双方之间的网络可以互相收发网络包，这种方式称为非转接，也叫对等￼。 c:59

互联网内部使用BGP机制在运营商之间交换路由信息。 c:83

公司中使用的方式是寻找与目的地之间的最短路由，并按照最短路由来转发包，因此，周围的所有路由器都是平等对待的。 c:79

设置一个中心设备，通过连接到中心设备的方式来减少线路数量，这个中心设备就称为IX。 c:60

IX的核心是具有大量高速以太网[插图]端口的二层交换机（图4.28）[插图]。二层交换机的基本原理和一般交换机相同，大家可以认为IX的核心就是大型的、高速的交换机。 c:83

### CoIumn网络术语其实很简单

现在的计算机也可以当路由器用哦。Linux等UNIX系操作系统都内置了路由功能，Windows Server版本也具有路由功能。 c:50

专用硬件可以通过芯片实现非常快速的处理，因此性能更好。 c:27

### 第5章 服务器端的局域网中有什么玄机

防火墙不会检查通信数据的具体内容，因此无法抵御隐藏在通信数据内容中的攻击。 c:28

### 5.1 Web服务器的部署地点

部署防火墙[插图]。防火墙的作用类似于海关，它只允许发往指定服务器的指定应用程序的网络包通过，从而屏蔽其他不允许通过的包。 c:91

图5.1 服务器的所在地 c:16

数据中心通过高速线路直接连接到互联网的核心部分，因此将服务器部署在这里可以获得很高的访问速度[插图]，当服务器访问量很大时这是非常有效的。 c:113

### 5.2 防火墙的结构和原理

防火墙的基本思路刚才已经介绍过了，即只允许发往特定服务器中的特定应用程序的包通过，然后屏蔽其他的包。 c:154

表5.1 地址转换和包过滤中用于设置规则的字段 c:41

如果判断结果为阻止，那么这个包会被丢弃并被记录下来[插图]。这是因为这些被丢弃的包中通常含有非法入侵的痕迹，通过分析这些包能够搞清楚入侵者使用的手法，从而帮助我们更好地防范非法入侵。 c:58

实际上，在防火墙允许包通过之后，就没有什么特别的机制了，因此包过滤并不是防火墙专用的一种特殊机制，而是应该看作在路由器的包转发功能基础上附加的一种功能。只不过当判断规则比较复杂时，通过路由器的命令难以维护这些规则，而且对阻止的包进行记录对于路由器来说负担也比较大，因此才出现了专用的硬件和软件。如果规则不复杂，也不需要记录日志，那么用内置包过滤功能的普通路由器来充当防火墙也是可以的。 c:74

包过滤方式的防火墙可根据接收方IP地址、发送方IP地址、接收方端口号、发送方端口号、控制位等信息来判断是否允许某个包通过。 c:192

通过这个例子大家可以看出，只有检查包的内容才能识别这种风险，因此防火墙对这种情况无能为力。 c:60

### 5.4 使用缓存服务器分担负载

除了使用多台功能相同的Web服务器分担负载之外，还有另外一种方法，就是将整个系统按功能分成不同的服务器￼，如Web服务器、数据库服务器。缓存服务器就是一种按功能来分担负载的方法。 c:147

除了使用多台功能相同的Web服务器分担负载之外，还有另外一种方法，就是将整个系统按功能分成不同的服务器[插图]，如Web服务器、数据库服务器。缓存服务器就是一种按功能来分担负载的方法。 c:118

Web服务器需要执行检查网址和访问权限，以及在页面上填充数据等内部操作过程，因此将页面数据返回客户端所需的时间较长。 c:74

缓存服务器使用的代理机制最早就是放在客户端一侧的，这才是代理的原型，称为正向代理￼（forward proxy）。 c:168

我们可以通过将请求消息中的URI中的目录名与Web服务器进行关联，使得代理能够转发一般的不包含完整网址的请求消息。我们前面介绍的服务器端的缓存服务器采用的正是这种方式，这种方式称为反向代理（reverse proxy）。 c:73

缓存服务器判断转发目标的方法还有一种，那就是查看请求消息的包头部。因为包的IP头部中包含接收方IP地址，只要知道了这个地址，就知道用户要访问哪台服务器了[插图]。这种方法称为透明代理（transparent proxy）。 c:91

使用透明代理时，用户不会察觉到代理的存在，也不会注意到HTTP消息是如何被转发的，因此大家更倾向于将透明代理说成是缓存[插图]。 c:45

### 5.5 内容分发服务

当缓存服务器放在服务器端时，可以减轻Web服务器的负载，但无法减少互联网中的流量。这一点上，将缓存服务器放在客户端更有效（ c:100

图5.10 缓存服务器的3种部署方式 c:23

Web服务器运营者和网络运营商签约，将可以自己控制的缓存服务器放在客户端的运营商处。 c:108

为了解决这个问题，一些专门从事相关服务的厂商出现了，他们来部署缓存服务器，并租借给Web服务器运营者。这种服务称为内容分发服务￼。 c:124

提供这种服务的厂商称为CDSP[插图]，他们会与主要的供应商签约，并部署很多台缓存服务器[插图]。 c:67

第一个方法是像负载均衡一样用DNS服务器来分配访问 c:42

对DNS服务器进行扩展的方法是估算客户端DNS服务器到缓存服务器之间的距离，因此精度较差；相对而言，重定向的方法是根据客户端发送来的HTTP消息的发送方IP地址来估算距离的，因此精度较高。 c:83

要改善这一点，有一种方法是让Web服务器在原始数据发生更新时，立即通知缓存服务器，使得缓存服务器上的数据一直保持最新状态，这样就不需要每次确认原始数据是否有变化了，而且从第一次访问就可以发挥缓存的效果。内容分发服务采用的缓存服务器就具备这样的功能。 c:91

### 6.1 服务器概览

网络相关的部分，如网卡、协议栈、Socket库等功能和客户端却并无二致 c:23

服务器操作系统具有多任务[插图]、多线程[插图]功能，可以同时运行多个程序[插图]，服务器程序的设计正是利用了这一功能。 c:113

使用描述符来指代套接字的原因如下。
（1）等待连接的套接字中没有客户端IP地址和端口号
（2）使用描述符这一种信息比较简单 c:137

使用描述符来指代套接字的原因如下。（1）等待连接的套接字中没有客户端IP地址和端口号（2）使用描述符这一种信息比较简单 c:96

### 6.2 服务器的接收操作

接收操作的第一步是网卡接收到信号，然后将其还原成数字信息[插图]。局域网中传输的网络包信号是由1和0组成的数字信息与用来同步的时钟信号叠加而成的，因此只要从中分离出时钟信号，然后根据时钟信号进行同步，就可以读取并还原出1和0的数字信息了。 c:82

网卡的MAC模块将网络包从信号还原为数字信息，校验FCS并存入缓冲区。 c:165

协议栈的IP模块会检查IP头部，（1）判断是不是发给自己的；（2）判断网络包是否经过分片；（3）将包转交给TCP模块或UDP模块。 c:200

### 6.3 Web服务器程序解释请求消息并作出响应

Web服务器的访问控制规则主要有以下3种。（1）客户端IP地址（2）客户端域名（3）用户名和密码 c:85

Web服务器调用Socket库的write，将响应消息交给协议栈。这时，需要告诉协议栈这个响应消息应该发给谁，但我们并不需要直接告知客户端的IP地址等信息，而是只需要给出表示通信使用的套接字的描述符就可以了。 c:54

### 6.4 浏览器接收响应消息并显示内容

原则上可以根据响应消息开头的Content-Type头部字段的值来进行判断 c:79

### CoIumn网络术语其实很简单

CGI指的不是CGI程序本身，而是连接程序与Web服务器程序的接口规格。所以说，客户端发送的消息是通过CGI这样一个接口，从Web服务器程序进入CGI程序的。 c:98

一开始并没有路由器这个词，那时候是管路由器叫网关的。从某种角度来说，路由器就是通向另一个网络的入口，所以默认网关的叫法也是那时候遗留下来的。 c:57
